sudo: required

services: 
    - docker
    
before_install:
    - docker build -t dockerwebapp/frontend -f ./client/Dockerfile.dev ./client
script:
    - docker run -e CI=true dockerwebapp/frontend npm run test -- --coverage

after_success:
    - docker build -t dockerwebapp/client ./client
    - docker build -t dockerwebapp/nginx ./nginx       
    - docker build -t dockerwebapp/server ./server 
    - docker build -t dockerwebapp/worker ./worker 

    - echo "$DOCKER_PASS" | docker login -u "$DOCKER_ID" --password-stdin

    - docker push sagarmshukla/dockerwebapp/client
    - docker push sagarmshukla/dockerwebapp/nginx
    - docker push sagarmshukla/dockerwebapp/server
    - docker push sagarmshukla/dockerwebapp/worker            

#deploy:
#    provider: elasticbeanstalk
#    region: "us-east-1"
#    app: "DockerWeb"
#    env: "DockerWeb-env"
#    bucket_name: "elasticbeanstalk-us-east-1-192588716298"
#    bucket_path: "docker"
#    access_key_id: $AWS_ACCESS_KEY
#    secret_access_key: "$AWS_KEY"
#    on:
#        branch: Master

